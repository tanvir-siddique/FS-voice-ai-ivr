<!--
  Voice AI Secretary Extension
  
  Add this to your FusionPBX dialplan or include it.
  Default extension: 8000
  
  MULTI-TENANT: domain_uuid is inherited from the call context
-->

<extension name="voice-ai-secretary" continue="false">
  <condition field="destination_number" expression="^8000$">
    <!-- Log the call -->
    <action application="log" data="INFO [VOICE_AI] Incoming call to secretary from ${caller_id_number}"/>
    
    <!-- Set variables for the script -->
    <action application="set" data="voice_ai_secretary=true"/>
    <action application="set" data="continue_on_fail=true"/>
    
    <!-- Execute the Lua secretary script -->
    <action application="lua" data="secretary_ai.lua"/>
    
    <!-- If script fails/exits without transfer, go to voicemail -->
    <action application="log" data="WARNING [VOICE_AI] Script ended, going to voicemail"/>
    <action application="voicemail" data="default ${domain_name} 200"/>
  </condition>
</extension>

<!--
  Alternative: Range of extensions for multiple secretaries
  
  Example: 8001-8009 for different secretary configurations
-->
<extension name="voice-ai-secretary-multi" continue="false">
  <condition field="destination_number" expression="^(800[1-9])$">
    <action application="log" data="INFO [VOICE_AI] Secretary $1 called from ${caller_id_number}"/>
    
    <!-- Pass the secretary number as variable -->
    <action application="set" data="voice_ai_secretary_num=$1"/>
    <action application="set" data="voice_ai_secretary=true"/>
    
    <action application="lua" data="secretary_ai.lua"/>
    
    <action application="voicemail" data="default ${domain_name} 200"/>
  </condition>
</extension>

<!--
  Inbound DID routing to secretary
  
  Example: All calls to a specific DID go to secretary
-->
<extension name="voice-ai-secretary-did" continue="false">
  <condition field="${destination_number}" expression="^(\+?55\d{10,11})$" break="never"/>
  <condition field="${sip_to_user}" expression="^secretary$">
    <action application="log" data="INFO [VOICE_AI] DID call to secretary"/>
    <action application="lua" data="secretary_ai.lua"/>
    <action application="voicemail" data="default ${domain_name} 200"/>
  </condition>
</extension>
