<!--
Dialplan para Secretária Virtual com IA
Instalar em: /etc/freeswitch/dialplan/default/99_voice_secretary.xml

⚠️ MULTI-TENANT: O domain_uuid é automaticamente disponibilizado pelo FreeSWITCH
-->

<extension name="voice-ai-secretary" continue="false">
    <condition field="destination_number" expression="^(8000|secretary)$">
        <!-- Log da chamada -->
        <action application="log" data="INFO [VOICE-AI] Call to secretary from ${caller_id_number}"/>
        
        <!-- Configurar variáveis -->
        <action application="set" data="RECORD_STEREO=true"/>
        <action application="set" data="RECORD_SAMPLE_RATE=16000"/>
        <action application="set" data="playback_terminators=none"/>
        
        <!-- Atender e processar com IA -->
        <action application="answer"/>
        <action application="sleep" data="500"/>
        
        <!-- Executar script Lua da secretária -->
        <action application="lua" data="secretary_ai.lua"/>
    </condition>
</extension>

<!--
Variantes por DID (opcional):
Configure múltiplos números para diferentes secretárias
-->

<extension name="voice-ai-secretary-by-did" continue="false">
    <condition field="${sip_to_user}" expression="^(\+?55\d{10,11})$">
        <condition field="${voice_secretary_enabled}" expression="^true$">
            <action application="log" data="INFO [VOICE-AI] DID call to secretary from ${caller_id_number}"/>
            <action application="answer"/>
            <action application="sleep" data="500"/>
            <action application="lua" data="secretary_ai.lua"/>
        </condition>
    </condition>
</extension>
