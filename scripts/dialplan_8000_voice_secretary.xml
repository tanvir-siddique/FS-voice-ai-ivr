<!--
  Dialplan para Voice Secretary AI (extensão 8000)
  
  Este dialplan deve ser adicionado ao FusionPBX via interface web:
    Dialplan > Dialplan Manager > Add
  
  Ou diretamente no banco de dados v_dialplans.
  
  IMPORTANTE:
    - order: 5 (baixo para executar antes do catch-all)
    - enabled: true
    - continue: false (CRÍTICO - evita cair em not-found)
    
  Ref: https://github.com/os11k/freeswitch-elevenlabs-bridge
  Ref: https://www.cyberpunk.tools/jekyll/update/2025/11/18/add-ai-voice-agent-to-freeswitch.html
-->

<extension name="voice_secretary_8000" continue="false">
  <condition field="destination_number" expression="^8000$">
    <!-- Executar script Lua que gerencia a sessão -->
    <action application="lua" data="voice_secretary.lua"/>
  </condition>
</extension>

<!--
  SQL para inserir/atualizar o dialplan diretamente no banco:
  
  UPDATE v_dialplans
  SET 
    dialplan_order = 5,
    dialplan_continue = 'false',
    dialplan_enabled = 'true',
    dialplan_xml = '<extension name="voice_secretary_8000" continue="false">
      <condition field="destination_number" expression="^8000$">
        <action application="lua" data="voice_secretary.lua"/>
      </condition>
    </extension>'
  WHERE dialplan_name = 'voice_secretary_8000_public'
    AND dialplan_context = 'public';
  
  Depois execute:
    fs_cli -x "reloadxml"
    fs_cli -x "xml_flush_cache dialplan.public.8000"
-->
